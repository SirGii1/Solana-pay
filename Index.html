<!DOCTYPE html>

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sagygram - Fast, Secure, Reliable Messaging</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #f5f7fa;
        height: 100vh;
        overflow: hidden;
    }

    .app-container {
        max-width: 400px;
        margin: 0 auto;
        height: 100vh;
        background: white;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        position: relative;
    }

    /* Auth Styles */
    .auth-view, .verification-view {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        padding: 2rem;
        text-align: center;
    }

    .logo {
        font-size: 4rem;
        margin-bottom: 1rem;
    }

    .app-title {
        font-size: 2rem;
        font-weight: bold;
        color: #2563eb;
        margin-bottom: 0.5rem;
    }

    .app-subtitle {
        color: #6b7280;
        margin-bottom: 3rem;
    }

    .form-group {
        width: 100%;
        margin-bottom: 1rem;
    }

    .form-label {
        display: block;
        font-weight: 500;
        color: #374151;
        margin-bottom: 0.5rem;
        text-align: left;
    }

    .form-input {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 2px solid #e5e7eb;
        border-radius: 0.5rem;
        font-size: 1rem;
        transition: all 0.2s;
    }

    .form-input:focus {
        outline: none;
        border-color: #2563eb;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .btn-primary {
        width: 100%;
        background: #2563eb;
        color: white;
        padding: 0.75rem;
        border: none;
        border-radius: 0.5rem;
        font-size: 1rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .btn-primary:hover:not(:disabled) {
        background: #1d4ed8;
    }

    .btn-primary:disabled {
        background: #d1d5db;
        cursor: not-allowed;
    }

    .back-link {
        color: #2563eb;
        text-decoration: none;
        margin-top: 1rem;
        font-size: 0.875rem;
    }

    .back-link:hover {
        text-decoration: underline;
    }

    .demo-code {
        background: #f3f4f6;
        padding: 0.5rem;
        border-radius: 0.25rem;
        margin-top: 1rem;
        font-size: 0.875rem;
        color: #6b7280;
    }

    /* Main App Styles */
    .main-view {
        display: none;
        flex-direction: column;
        height: 100vh;
    }

    .main-view.active {
        display: flex;
    }

    .header {
        background: #2563eb;
        color: white;
        padding: 1rem;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .header-title {
        font-size: 1.25rem;
        font-weight: 600;
        flex: 1;
    }

    .header-actions {
        display: flex;
        gap: 0.5rem;
    }

    .icon-btn {
        background: none;
        border: none;
        color: white;
        padding: 0.5rem;
        border-radius: 50%;
        cursor: pointer;
        transition: background 0.2s;
    }

    .icon-btn:hover {
        background: rgba(255, 255, 255, 0.1);
    }

    .search-container {
        padding: 1rem;
        background: #2563eb;
    }

    .search-input {
        width: 100%;
        padding: 0.75rem 1rem 0.75rem 2.5rem;
        border: none;
        border-radius: 0.5rem;
        font-size: 1rem;
        background: white;
        position: relative;
    }

    .search-icon {
        position: absolute;
        left: 1.75rem;
        top: 1.75rem;
        color: #6b7280;
        pointer-events: none;
    }

    .new-chat-btn {
        margin: 1rem;
        padding: 0.75rem 1rem;
        background: none;
        border: none;
        color: #2563eb;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        cursor: pointer;
        border-radius: 0.5rem;
        transition: background 0.2s;
    }

    .new-chat-btn:hover {
        background: rgba(37, 99, 235, 0.05);
    }

    .conversations-list {
        flex: 1;
        overflow-y: auto;
    }

    .conversation-item {
        display: flex;
        align-items: center;
        padding: 1rem;
        cursor: pointer;
        border-bottom: 1px solid #f3f4f6;
        transition: background 0.2s;
    }

    .conversation-item:hover {
        background: #f9fafb;
    }

    .avatar {
        width: 3rem;
        height: 3rem;
        background: #e5e7eb;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        position: relative;
    }

    .online-indicator {
        position: absolute;
        bottom: 0;
        right: 0;
        width: 0.75rem;
        height: 0.75rem;
        background: #10b981;
        border: 2px solid white;
        border-radius: 50%;
    }

    .conversation-content {
        flex: 1;
        margin-left: 1rem;
        min-width: 0;
    }

    .conversation-header {
        display: flex;
        justify-content: space-between;
        align-items: baseline;
        margin-bottom: 0.25rem;
    }

    .conversation-name {
        font-weight: 600;
        color: #111827;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .conversation-time {
        font-size: 0.75rem;
        color: #6b7280;
        white-space: nowrap;
    }

    .conversation-preview {
        font-size: 0.875rem;
        color: #6b7280;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .unread-badge {
        background: #2563eb;
        color: white;
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
        border-radius: 1rem;
        margin-left: 0.5rem;
        min-width: 1.25rem;
        text-align: center;
    }

    /* Chat View */
    .chat-header {
        background: #2563eb;
        color: white;
        padding: 1rem;
        display: flex;
        align-items: center;
        gap: 1rem;
    }

    .chat-messages {
        flex: 1;
        overflow-y: auto;
        padding: 1rem;
        background: #f9fafb;
    }

    .message {
        margin-bottom: 1rem;
        display: flex;
    }

    .message.sent {
        justify-content: flex-end;
    }

    .message.received {
        justify-content: flex-start;
    }

    .message-bubble {
        max-width: 70%;
        padding: 0.75rem 1rem;
        border-radius: 1rem;
        position: relative;
    }

    .message.sent .message-bubble {
        background: #2563eb;
        color: white;
        border-bottom-right-radius: 0.25rem;
    }

    .message.received .message-bubble {
        background: white;
        color: #111827;
        border-bottom-left-radius: 0.25rem;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .message-text {
        font-size: 0.875rem;
        line-height: 1.4;
    }

    .message-meta {
        display: flex;
        align-items: center;
        gap: 0.25rem;
        margin-top: 0.25rem;
        justify-content: flex-end;
    }

    .message-time {
        font-size: 0.75rem;
        opacity: 0.7;
    }

    .message-status {
        width: 1rem;
        height: 1rem;
        opacity: 0.7;
    }

    .typing-indicator {
        display: flex;
        justify-content: flex-start;
        margin-bottom: 1rem;
    }

    .typing-bubble {
        background: white;
        padding: 0.75rem 1rem;
        border-radius: 1rem;
        border-bottom-left-radius: 0.25rem;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

    .typing-dots {
        display: flex;
        gap: 0.25rem;
    }

    .typing-dot {
        width: 0.5rem;
        height: 0.5rem;
        background: #6b7280;
        border-radius: 50%;
        animation: typing 1.4s infinite;
    }

    .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
    }

    .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
    }

    @keyframes typing {
        0%, 60%, 100% {
            transform: scale(1);
            opacity: 1;
        }
        30% {
            transform: scale(1.4);
            opacity: 0.5;
        }
    }

    .message-input-container {
        padding: 1rem;
        background: white;
        border-top: 1px solid #e5e7eb;
        display: flex;
        align-items: flex-end;
        gap: 0.5rem;
    }

    .message-input {
        flex: 1;
        padding: 0.75rem 1rem;
        border: 1px solid #e5e7eb;
        border-radius: 1.5rem;
        resize: none;
        font-size: 1rem;
        font-family: inherit;
        outline: none;
        transition: border-color 0.2s;
    }

    .message-input:focus {
        border-color: #2563eb;
    }

    .send-btn {
        background: #2563eb;
        color: white;
        border: none;
        padding: 0.75rem;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s;
    }

    .send-btn:hover:not(:disabled) {
        background: #1d4ed8;
        transform: scale(1.05);
    }

    .send-btn:disabled {
        background: #d1d5db;
        cursor: not-allowed;
        transform: none;
    }

    .attach-btn {
        background: none;
        border: none;
        color: #6b7280;
        padding: 0.75rem;
        border-radius: 50%;
        cursor: pointer;
        transition: all 0.2s;
    }

    .attach-btn:hover {
        background: #f3f4f6;
        color: #2563eb;
    }

    /* Modal */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
    }

    .modal-overlay.active {
        display: flex;
    }

    .modal {
        background: white;
        border-radius: 0.5rem;
        max-width: 90%;
        width: 20rem;
        max-height: 80vh;
        overflow: hidden;
    }

    .modal-header {
        padding: 1rem;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .modal-title {
        font-size: 1.125rem;
        font-weight: 600;
    }

    .close-btn {
        background: none;
        border: none;
        font-size: 1.5rem;
        cursor: pointer;
        padding: 0.25rem;
        border-radius: 0.25rem;
        color: #6b7280;
    }

    .close-btn:hover {
        background: #f3f4f6;
    }

    .modal-content {
        max-height: 20rem;
        overflow-y: auto;
    }

    .contact-item {
        display: flex;
        align-items: center;
        padding: 1rem;
        cursor: pointer;
        transition: background 0.2s;
    }

    .contact-item:hover {
        background: #f9fafb;
    }

    .contact-info {
        margin-left: 0.75rem;
        flex: 1;
    }

    .contact-name {
        font-weight: 500;
        margin-bottom: 0.125rem;
    }

    .contact-phone {
        font-size: 0.875rem;
        color: #6b7280;
    }

    /* Empty State */
    .empty-state {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 16rem;
        color: #6b7280;
        text-align: center;
        padding: 2rem;
    }

    .empty-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
    }

    /* Responsive */
    @media (max-width: 480px) {
        .app-container {
            max-width: 100%;
            height: 100vh;
        }
        
        .message-bubble {
            max-width: 85%;
        }
    }

    /* Hidden elements */
    .hidden {
        display: none !important;
    }

    /* Icons (using text-based icons for simplicity) */
    .icon-search::before { content: 'üîç'; }
    .icon-settings::before { content: '‚öôÔ∏è'; }
    .icon-back::before { content: '‚Üê'; }
    .icon-more::before { content: '‚ãÆ'; }
    .icon-plus::before { content: '+'; }
    .icon-attach::before { content: 'üìé'; }
    .icon-send::before { content: '‚û§'; }
    .icon-close::before { content: '√ó'; }
    .icon-check::before { content: '‚úì'; }
    .icon-check-double::before { content: '‚úì‚úì'; }
    .icon-clock::before { content: 'üïê'; }
</style>
```

</head>
<body>
    <div class="app-container">
        <!-- Authentication View -->
        <div id="authView" class="auth-view">
            <div class="logo">üí¨</div>
            <h1 class="app-title">Sagygram</h1>
            <p class="app-subtitle">Fast, secure, reliable messaging</p>

```
        <div class="form-group">
            <label class="form-label">Phone Number</label>
            <input 
                type="tel" 
                id="phoneInput" 
                class="form-input" 
                placeholder="+1 234 567 8900"
            >
        </div>
        
        <button id="continueBtn" class="btn-primary" disabled>
            Continue
        </button>
        
        <p style="font-size: 0.875rem; color: #6b7280; margin-top: 1.5rem; text-align: center;">
            By continuing, you agree to receive SMS verification codes.
        </p>
    </div>

    <!-- Verification View -->
    <div id="verificationView" class="verification-view hidden">
        <div class="logo">üì±</div>
        <h2 class="app-title" style="font-size: 1.5rem;">Verify your number</h2>
        <p class="app-subtitle">We sent a code to <strong id="phoneDisplay"></strong></p>
        
        <div class="form-group">
            <label class="form-label">Verification Code</label>
            <input 
                type="text" 
                id="otpInput" 
                class="form-input" 
                placeholder="Enter 6-digit code"
                maxlength="6"
                style="text-align: center; font-size: 1.25rem; letter-spacing: 0.25rem;"
            >
        </div>
        
        <button id="verifyBtn" class="btn-primary" disabled>
            Verify & Continue
        </button>
        
        <div class="demo-code">
            Demo code: <strong>123456</strong>
        </div>
        
        <a href="#" id="changeNumberLink" class="back-link">
            ‚Üê Change number
        </a>
    </div>

    <!-- Main App View -->
    <div id="mainView" class="main-view">
        <!-- Header -->
        <div class="header">
            <h1 class="header-title">Sagygram</h1>
            <div class="header-actions">
                <button class="icon-btn icon-search" id="searchBtn"></button>
                <button class="icon-btn icon-settings" id="settingsBtn"></button>
            </div>
        </div>

        <!-- Search -->
        <div class="search-container">
            <div style="position: relative;">
                <span class="search-icon icon-search"></span>
                <input 
                    type="text" 
                    id="searchInput" 
                    class="search-input" 
                    placeholder="Search messages or contacts"
                >
            </div>
        </div>

        <!-- New Chat Button -->
        <button class="new-chat-btn" id="newChatBtn">
            <span class="icon-plus"></span>
            New Chat
        </button>

        <!-- Conversations List -->
        <div class="conversations-list" id="conversationsList">
            <!-- Conversations will be populated by JavaScript -->
        </div>
    </div>

    <!-- Chat View -->
    <div id="chatView" class="main-view">
        <!-- Chat Header -->
        <div class="chat-header">
            <button class="icon-btn icon-back" id="backToChatListBtn"></button>
            <div class="avatar" id="chatAvatar">üë§</div>
            <div style="flex: 1;">
                <h2 id="chatName" style="font-weight: 600; margin-bottom: 0.125rem;">Contact Name</h2>
                <p id="chatStatus" style="font-size: 0.75rem; opacity: 0.8;">online</p>
            </div>
            <button class="icon-btn icon-more" id="chatMenuBtn"></button>
        </div>

        <!-- Messages -->
        <div class="chat-messages" id="chatMessages">
            <!-- Messages will be populated by JavaScript -->
        </div>

        <!-- Message Input -->
        <div class="message-input-container">
            <input type="file" id="fileInput" style="display: none;" accept="image/*,video/*,.pdf,.doc,.docx">
            <button class="attach-btn icon-attach" id="attachBtn"></button>
            <textarea 
                id="messageInput" 
                class="message-input" 
                placeholder="Type a message..."
                rows="1"
            ></textarea>
            <button class="send-btn icon-send" id="sendBtn" disabled></button>
        </div>
    </div>
</div>

<!-- New Chat Modal -->
<div id="newChatModal" class="modal-overlay">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">New Chat</h3>
            <button class="close-btn icon-close" id="closeModalBtn"></button>
        </div>
        <div style="padding: 1rem;">
            <input 
                type="text" 
                id="contactSearch" 
                class="form-input" 
                placeholder="Search contacts..."
            >
        </div>
        <div class="modal-content" id="contactsList">
            <!-- Contacts will be populated by JavaScript -->
        </div>
    </div>
</div>

<script>
    class SagygramApp {
        constructor() {
            this.currentUser = null;
            this.contacts = [];
            this.conversations = [];
            this.messages = {};
            this.activeChat = null;
            this.isTyping = {};
            this.typingTimeout = null;

            this.initMockData();
            this.initEventListeners();
        }

        initMockData() {
            // Mock contacts
            this.contacts = [
                { id: 1, name: 'Alice Johnson', phone: '+1234567890', avatar: 'üë©‚Äçüíº', lastSeen: 'online', isOnline: true },
                { id: 2, name: 'Bob Smith', phone: '+1234567891', avatar: 'üë®‚Äçüíª', lastSeen: '5 min ago', isOnline: false },
                { id: 3, name: 'Carol Davis', phone: '+1234567892', avatar: 'üë©‚Äçüé®', lastSeen: '1 hour ago', isOnline: false },
                { id: 4, name: 'David Wilson', phone: '+1234567893', avatar: 'üë®‚Äçüî¨', lastSeen: 'yesterday', isOnline: false },
                { id: 5, name: 'Emma Brown', phone: '+1234567894', avatar: 'üë©‚Äçüè´', lastSeen: 'online', isOnline: true },
                { id: 6, name: 'Frank Miller', phone: '+1234567895', avatar: 'üë®‚Äçüé®', lastSeen: '2 hours ago', isOnline: false },
                { id: 7, name: 'Grace Chen', phone: '+1234567896', avatar: 'üë©‚Äçüíª', lastSeen: '30 min ago', isOnline: false }
            ];

            // Mock conversations
            this.conversations = [
                {
                    id: 1,
                    contactId: 1,
                    name: 'Alice Johnson',
                    avatar: 'üë©‚Äçüíº',
                    lastMessage: 'Hey! How are you doing?',
                    timestamp: new Date(Date.now() - 300000), // 5 min ago
                    unread: 2,
                    isOnline: true
                },
                {
                    id: 2,
                    contactId: 2,
                    name: 'Bob Smith',
                    avatar: 'üë®‚Äçüíª',
                    lastMessage: 'The project looks great!',
                    timestamp: new Date(Date.now() - 3600000), // 1 hour ago
                    unread: 0,
                    isOnline: false
                },
                {
                    id: 3,
                    contactId: 3,
                    name: 'Carol Davis',
                    avatar: 'üë©‚Äçüé®',
                    lastMessage: 'Thanks for your help',
                    timestamp: new Date(Date.now() - 86400000), // 1 day ago
                    unread: 1,
                    isOnline: false
                }
            ];

            // Mock messages
            this.messages = {
                1: [
                    { id: 1, text: 'Hi Alice! How\'s the new job going?', sender: 'me', timestamp: new Date(Date.now() - 3600000), status: 'read' },
                    { id: 2, text: 'Hey! It\'s going really well, thanks for asking! üòä', sender: 'contact', timestamp: new Date(Date.now() - 3540000), status: 'delivered' },
                    { id: 3, text: 'The team is super friendly and the projects are interesting', sender: 'contact', timestamp: new Date(Date.now() - 3520000), status: 'delivered' },
                    { id: 4, text: 'That\'s awesome! I\'m so happy for you', sender: 'me', timestamp: new Date(Date.now() - 3480000), status: 'read' },
                    { id: 5, text: 'What kind of projects are you working on?', sender: 'me', timestamp: new Date(Date.now() - 3460000), status: 'read' },
                    { id: 6, text: 'Mostly mobile app development and some web stuff', sender: 'contact', timestamp: new Date(Date.now() - 3420000), status: 'delivered' },
                    { id: 7, text: 'Hey! How are you doing?', sender: 'contact', timestamp: new Date(Date.now() - 300000), status: 'delivered' },
                    { id: 8, text: 'Pretty good, working on a new messaging app project', sender: 'me', timestamp: new Date(Date.now() - 240000), status: 'read' },
                    { id: 9, text: 'That sounds exciting! What kind of features?', sender: 'contact', timestamp: new Date(Date.now() - 180000), status: 'delivered' }
                ],
                2: [
                    { id: 10, text: 'Hey Bob, can you check the latest designs?', sender: 'me', timestamp: new Date(Date.now() - 7200000), status: 'read' },
                    { id: 11, text: 'Sure! Just reviewed them', sender: 'contact', timestamp: new Date(Date.now() - 6600000), status: 'delivered' },
                    { id: 12, text: 'The project looks great!', sender: 'contact', timestamp: new Date(Date.now() - 3600000), status: 'delivered' },
                    { id: 13, text: 'Thanks Bob! Appreciate the feedback', sender: 'me', timestamp: new Date(Date.now() - 3300000), status: 'read' }
                ],
                3: [
                    { id: 14, text: 'Hi Carol, could you help me with the color scheme?', sender: 'me', timestamp: new Date(Date.now() - 172800000), status: 'read' },
                    { id: 15, text: 'Of course! I\'ll send you some options', sender: 'contact', timestamp: new Date(Date.now() - 172500000), status: 'delivered' },
                    { id: 16, text: 'Thanks for your help', sender: 'contact', timestamp: new Date(Date.now() - 86400000), status: 'delivered' }
                ]
            };
        }

        initEventListeners() {
            // Auth flow
            const phoneInput = document.getElementById('phoneInput');
            const continueBtn = document.getElementById('continueBtn');
            const otpInput = document.getElementById('otpInput');
            const verifyBtn = document.getElementById('verifyBtn');
            const changeNumberLink = document.getElementById('changeNumberLink');

            phoneInput.addEventListener('input', () => {
                continueBtn.disabled = phoneInput.value.length < 10;
            });

            continueBtn.addEventListener('click', () => this.handleAuth());

            otpInput.addEventListener('input', () => {
                verifyBtn.disabled = otpInput.value.length !== 6;
            });

            verifyBtn.addEventListener('click', () => this.handleVerification());
            changeNumberLink.addEventListener('click', (e) => {
                e.preventDefault();
                this.showView('authView');
            });

            // Main app
            document.getElementById('newChatBtn').addEventListener('click', () => this.showNewChatModal());
            document.getElementById('closeModalBtn').addEventListener('click', () => this.hideNewChatModal());
            document.getElementById('newChatModal').addEventListener('click', (e) => {
                if (e.target.id === 'newChatModal') this.hideNewChatModal();
            });

            // Chat
            document.getElementById('backToChatListBtn').addEventListener('click', () => this.showView('mainView'));
            document.getElementById('sendBtn').addEventListener('click', () => this.sendMessage());
            document.getElementById('attachBtn').addEventListener('click', () => document.getElementById('fileInput').click());
            document.getElementById('fileInput').addEventListener('change', (e) => this.handleFileUpload(e));

            const messageInput = document.getElementById('messageInput');
            messageInput.addEventListener('input', () => this.handleMessageInput());
            messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    this.sendMessage();
                }
            });

            // Search
            document.getElementById('searchInput').addEventListener('input', (e) => this.handleSearch(e.target.value));
            document.getElementById('contactSearch').addEventListener('input', (e) => this.renderContacts(e.target.value));

            // Initialize
            this.renderConversations();
            this.renderContacts();
        }

        showView(viewId) {
            document.querySelectorAll('.auth-view, .verification-view, .main-view').forEach(view => {
                view.classList.add('hidden');
            });
            document.getElementById(viewId).classList.remove('hidden');
            
            if (viewId === 'mainView') {
                document.getElementById(viewId).classList.add('active');
            }
        }

        handleAuth() {
            const phoneInput = document.getElementById('phoneInput');
            if (phoneInput.value.length >= 10) {
                document.getElementById('phoneDisplay').textContent = phoneInput.value;
                this.showView('verificationView');
            }
        }

        handleVerification() {
            const otpInput = document.getElementById('otpInput');
            if (otpInput.value === '123456') {
                this.currentUser = { 
                    phone: document.getElementById('phoneInput').value, 
                    name: 'You', 
                    avatar: 'üë§' 
                };
                this.showView('mainView');
            }
        }

        formatTime(timestamp) {
            const now = new Date();
            const time = new Date(timestamp);
            const diffInHours = (now - time) / (1000 * 60 * 60);
            
            if (diffInHours < 1) {
                return 'now';
            } else if (diffInHours < 24) {
                return time.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            } else if (diffInHours < 48) {
                return 'Yesterday';
            } else {
                return time.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            }
        }

        renderConversations(searchQuery = '') {
            const container = document.getElementById('conversationsList');
            const filtered = this.conversations.filter(conv => 
                conv.name.toLowerCase().includes(searchQuery.toLowerCase())
            );

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üí¨</div>
                        <p><strong>No conversations yet</strong></p>
                        <p style="font-size: 0.875rem; margin-top: 0.5rem;">Start a new chat to begin messaging</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map(conv => `
                <div class="conversation-item" onclick="app.openChat(${conv.id})">
                    <div class="avatar">
                        ${conv.avatar}
                        ${conv.isOnline ? '<div class="online-indicator"></div>' : ''}
                    </div>
                    <div class="conversation-content">
                        <div class="conversation-header">
                            <div class="conversation-name">${conv.name}</div>
                            <div class="conversation-time">${this.formatTime(conv.timestamp)}</div>
                        </div>
                        <div class="conversation-preview">${conv.lastMessage}</div>
                    </div>
                    ${conv.unread > 0 ? `<div class="unread-badge">${conv.unread}</div>` : ''}
                </div>
            `).join('');
        }

        renderContacts(searchQuery = '') {
            const container = document.getElementById('contactsList');
            const filtered = this.contacts.filter(contact => 
                contact.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                contact.phone.includes(searchQuery)
            );

            container.innerHTML = filtered.map(contact => `
                <div class="contact-item" onclick="app.startNewChat(${contact.id})">
                    <div class="avatar">
                        ${contact.avatar}
                        ${contact.isOnline ? '<div class="online-indicator"></div>' : ''}
                    </div>
                    <div class="contact-info">
                        <div class="contact-name">${contact.name}</div>
                        <div class="contact-phone">${contact.phone}</div>
                    </div>
                </div>
            `).join('');
        }

        openChat(conversationId) {
            this.activeChat = this.conversations.find(conv => conv.id === conversationId);
            if (!this.activeChat) return;

            // Update UI
            document.getElementById('chatAvatar').textContent = this.activeChat.avatar;
            document.getElementById('chatName').textContent = this.activeChat.name;
            document.getElementById('chatStatus').textContent = this.activeChat.isOnline ? 'online' : 'last seen recently';

            // Mark as read
            this.activeChat.unread = 0;
            this.renderConversations();
            this.renderMessages();
            this.showView('chatView');
        }

        startNewChat(contactId) {
            const contact = this.contacts.find(c => c.id === contactId);
            if (!contact) return;

            // Check if conversation already exists
            let existingConv = this.conversations.find(conv => conv.contactId === contactId);
            
            if (!existingConv) {
                // Create new conversation
                existingConv = {
                    id: Date.now(),
                    contactId: contactId,
                    name: contact.name,
                    avatar: contact.avatar,
                    lastMessage: '',
                    timestamp: new Date(),
                    unread: 0,
                    isOnline: contact.isOnline
                };
                
                this.conversations.unshift(existingConv);
                this.messages[existingConv.id] = [];
            }
            
            this.hideNewChatModal();
            this.openChat(existingConv.id);
        }

        renderMessages() {
            const container = document.getElementById('chatMessages');
            const chatMessages = this.messages[this.activeChat.id] || [];
            
            let html = chatMessages.map(message => {
                const messageClass = message.sender === 'me' ? 'sent' : 'received';
                const statusIcon = message.sender === 'me' ? this.getStatusIcon(message.status) : '';
                
                return `
                    <div class="message ${messageClass}">
                        <div class="message-bubble">
                            <div class="message-text">${message.text}</div>
                            <div class="message-meta">
                                <span class="message-time">${this.formatTime(message.timestamp)}</span>
                                ${statusIcon}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            // Add typing indicator if active
            if (this.isTyping[this.activeChat.id]) {
                html += `
                    <div class="typing-indicator">
                        <div class="typing-bubble">
                            <div class="typing-dots">
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                            </div>
                        </div>
                    </div>
                `;
            }

            container.innerHTML = html;
            container.scrollTop = container.scrollHeight;
        }

        getStatusIcon(status) {
            switch (status) {
                case 'sent':
                    return '<span class="message-status icon-clock"></span>';
                case 'delivered':
                    return '<span class="message-status icon-check"></span>';
                case 'read':
                    return '<span class="message-status icon-check-double" style="color: #2563eb;"></span>';
                default:
                    return '';
            }
        }

        handleMessageInput() {
            const input = document.getElementById('messageInput');
            const sendBtn = document.getElementById('sendBtn');
            
            sendBtn.disabled = !input.value.trim();
            
            if (this.activeChat && input.value.trim()) {
                // Show typing indicator
                this.isTyping[this.activeChat.id] = true;
                this.renderMessages();
                
                // Clear existing timeout
                if (this.typingTimeout) {
                    clearTimeout(this.typingTimeout);
                }
                
                // Set new timeout to hide typing indicator
                this.typingTimeout = setTimeout(() => {
                    this.isTyping[this.activeChat.id] = false;
                    this.renderMessages();
                }, 2000);
            } else {
                this.isTyping[this.activeChat.id] = false;
                this.renderMessages();
            }
        }

        sendMessage() {
            const input = document.getElementById('messageInput');
            const messageText = input.value.trim();
            
            if (!messageText || !this.activeChat) return;

            const messageId = Date.now();
            const message = {
                id: messageId,
                text: messageText,
                sender: 'me',
                timestamp: new Date(),
                status: 'sent'
            };

            // Add message to chat
            if (!this.messages[this.activeChat.id]) {
                this.messages[this.activeChat.id] = [];
            }
            this.messages[this.activeChat.id].push(message);

            // Update conversation
            this.activeChat.lastMessage = messageText;
            this.activeChat.timestamp = new Date();
            
            // Clear input
            input.value = '';
            document.getElementById('sendBtn').disabled = true;
            
            // Clear typing indicator
            this.isTyping[this.activeChat.i
```
